{{define "requests"}} {{ template "header" }}

<div class="input-group input-group-lg" style="margin-bottom:20px;">
    <span class="input-group-addon" id="sizing-addon1">Endpoint:</span>
    <input type="text" class="form-control" value="http://{{.Domain}}/{{.URL}}" id="input">
</div>

<a href="/{{.URL}}/clear" class="btn btn-danger" role="button" style="float:right;">Clear</a>

<table class="table table-hover table-condensed table-responsive">
    <thead>
        <tr>
            <th width="30%">Info</th>
            <th width="35%">POST</th>
            <th width="35%">Headers</th>
        </tr>
    </thead>
    <tbody>

    </tbody>
</table>

<script type="text/javascript">
    // Load data into table rows
    $.each(JSON.parse('{{.Requests}}'), function (index, item) {
        addRow(item);
    });

    function addRow(data) {

        data.info = JSON.stringify({
            'method': data.method,
            'ip': data.ip,
            'time': data.time,
            'referer': data.referer,
            'body': data.body
        });

        var row = $('<tr><td>' + data.info + '</td><td>' + data.post + '</td><td>' + data.headers + '</td></tr>');
        $('table tbody').prepend(row);
        
    }

    // Clicking the endpoint URL
    $("#input")
        .on('click', function () {
            this.select();
            document.execCommand("copy");
            Push.create('Copied to clipboard!');
            $(this).parent().addClass("has-success");
        }).on('blur', function () {
            $(this).parent().removeClass("has-success");
        });

    // Handle WebSockets
    if (window.WebSocket === undefined) {
        console.log('Your browser does not support WebSockets');
    } else {
        var pathArray = window.location.pathname.split('/');
        var socket = new WebSocket("ws://" + location.host + "/" + pathArray[1] + "/ws");

        socket.onopen = function (e) {
            console.log('WebSocket opened');
        };
        socket.onclose = function (e) {
            console.log('WebSocket closed');
        }
        socket.onmessage = function (e) {
            console.log('WebSocket recieved');
            Push.create('New request')
            addRow(JSON.parse(e.data));
        }
        socket.onerror = function (e) {
            console.log('WebSocket error: ' + e.data);
        }
    }

</script>

{{ template "footer" }} {{end}}