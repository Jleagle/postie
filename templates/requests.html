{{define "requests"}} {{ template "header" }}

<table>
    <thead>
        <tr>
            <th>IP</th>
        </tr>
    </thead>
    <tbody>
        {{range .Requests}}
        <tr>
            <td>{{.IP}}</td>
        </tr>
        {{end}}
    </tbody>
</table>

<script type="text/javascript">
    if (window.WebSocket === undefined) {
        console.log('Your browser does not support WebSockets');
    } else {

        var pathArray = window.location.pathname.split('/');
        var socket = new WebSocket("ws://" + location.host + "/" + pathArray[1] + "/ws");

        socket.onopen = function (e) {
            console.log('Socket opened');
        };
        socket.onclose = function (e) {
            console.log('Socket closed: ' + e.data);
        }
        socket.onmessage = function (e) {
            console.log('Socket data: ' + e.data);

            var data = JSON.parse(e.data);

            $("table tbody").prepend(
                $('<tr>').append(
                    $('<td>').text(data.ip),
                ).hide()
            ).find('tr').slideDown();
        }
        socket.onerror = function (e) {
            console.log('Socket error: ' + e.data);
        }
    }

</script>

{{ template "footer" }} {{end}}